<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Model Setup Summary</title>
  <style> 
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 20px;
    }
    .container {
      max-width: 95%; /* wider layout to accommodate large tables */
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #0056b3;
    }
    .accordion {
      background-color: #e0e0e0;
      color: #333;
      cursor: pointer;
      padding: 15px;
      width: 100%;
      text-align: left;
      border: none;
      outline: none;
      font-size: 16px;
      border-radius: 4px;
      margin-top: 10px;
    }
    .accordion.active, .accordion:hover {
      background-color: #ccc;
    }
    .panel {
      padding: 0 15px;
      display: none;
      background-color: #fff;
      overflow: hidden;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 4px 4px;
      margin-bottom: 10px;
    }
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      overflow-x: auto; /* allow horizontal scrolling */
      display: block; /* ensures overflow-x works correctly */
    }
    .summary-table th, .summary-table td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: left;
      font-size: 14px;
      white-space: nowrap; /* prevents wrapping in table cells */
    }
    .summary-table th {
      background-color: #f2f2f2;
    }
    .edit-link {
      float: right;
      font-size: 14px;
      text-decoration: none;
      color: #007BFF;
    }
    .edit-link:hover {
      text-decoration: underline;
    }
    .big-red-button {
      background: #d32f2f;
      color: white;
      padding: 20px 40px;
      font-size: 1.4em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      margin-top: 30px;
    }
    .big-red-button:hover {
      background: #b71c1c;
    }
    .save-project-box {
      background: #f0f8ff;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #007BFF;
      text-align: center;
    }
    .btn-save-project {
      background: #ffc107;
      color: #000;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 5px;
    }
    .btn-save-project:hover {
      background: #e0a800;
    }
  </style>
  </style>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
      var acc = document.getElementsByClassName("accordion");
      for (var i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
          this.classList.toggle("active");
          var panel = this.nextElementSibling;
          panel.style.display = panel.style.display === "block" ? "none" : "block";
        });
      }
    });
  </script>
</head>
<body>
  <div class="container">
    <h1>Model Setup Summary</h1>
    <p class="instructions">
        Below is a summary of everything you‚Äôve entered so far‚Äîfacilities, turbine 
        units, operating scenarios, flow data, and your fish population settings. 
        Look over the tables to make sure the details match what you intended. 
        If you spot something incorrect, use the ‚ÄúEdit‚Äù links to jump back and 
        make changes. Once everything looks good, click ‚ÄúRun Simulation‚Äù to let
        the model do its work.
    </p>    
    <!-- Project Summary -->
    <button class="accordion">Project Info <a class="edit-link" href="{{ url_for('create_project') }}">Edit</a></button>
    <div class="panel">
      <table class="summary-table">
        <tbody>
          <tr>
            <th>Project Name</th>
            <td>{{ project_name or 'N/A' }}</td>
          </tr>
          <tr>
            <th>Units</th>
            <td>{{ units or 'N/A' }}</td>
          </tr>
          <tr>
            <th>Model Setup</th>
            <td>{{ model_setup or 'N/A' }}</td>
          </tr>
          <tr>
            <th>Project Notes</th>
            <td style="white-space: normal;">{{ project_notes or 'N/A' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- Facilities Summary -->
    <button class="accordion">Facilities <a class="edit-link" href="{{ url_for('facilities') }}">Edit</a></button>
    <div class="panel">
      {% if session.facilities_data %}
      <table class="summary-table">
        <thead>
          <tr>
            <th>Facility</th>
            <th>Units</th>
            <th>Min Op Flow</th>
            <th>Env Flow</th>
            <th>Bypass Flow</th>
            <th>Spillway</th>
            <th>Operations</th>
          </tr>
        </thead>
        <tbody>
          {% for fac in session.facilities_data %}
          <tr>
            <td>{{ fac.Facility }}</td>
            <td>{{ fac.Units }}</td>
            <td>{{ fac["Min Op Flow"] }}</td>
            <td>{{ fac["Env Flow"] }}</td>
            <td>{{ fac["Bypass Flow"] }}</td>
            <td>{{ fac.Spillway }}</td>
            <td>{{ fac.Operations }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No facilities data available.</p>
      {% endif %}
    </div>
    
    <!-- Unit Parameters Summary -->
    <button class="accordion">Unit Parameters <a class="edit-link" href="{{ url_for('unit_parameters') }}">Edit</a></button>
    <div class="panel">
        {% if unit_param_warnings %}
        <div style="border: 1px solid #b0413e; background: #fff4f4; color: #7a1f1f; padding: 10px; margin: 10px 0; border-radius: 6px;">
          <strong>Missing or invalid unit parameters</strong>
          <ul style="margin: 6px 0 0 18px;">
            {% for warning in unit_param_warnings %}
              <li>{{ warning }}</li>
            {% endfor %}
          </ul>
          <p style="margin: 6px 0 0 0;">Update the Unit Parameters page before running the model.</p>
        </div>
        {% endif %}
        {% if unit_parameters %}
          <table class="summary-table">
            <thead>
              <tr>
                {% for col in unit_columns %}
                  <th>{{ col }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in unit_parameters %}
                <tr>
                  {% for value in row.values() %}
                    <td>{{ value }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>No unit parameters data available.</p>
        {% endif %}

    </div>
    
    <!-- Operating Scenarios Summary -->
    <button class="accordion">Operating Scenarios <a class="edit-link" href="{{ url_for('operating_scenarios') }}">Edit</a></button>
    <div class="panel">
      {% if operating_scenarios %}
      <table class="summary-table">
        <thead>
          <tr>
            <th>Scenario</th>
            <th>Facility</th>
            <th>Unit</th>
            <th>Hours</th>
            <th>Prob Not Operating</th>
            <th>Shape</th>
            <th>Location</th>
            <th>Scale</th>
          </tr>
        </thead>
        <tbody>
          {% for row in operating_scenarios %}
          <tr>
            <td>{{ row['Scenario'] }}</td>
            <td>{{ row['Facility'] }}</td>
            <td>{{ row['Unit'] }}</td>
            <td>{{ row['Hours'] }}</td>
            <td>{{ row['Prob Not Operating'] }}</td>
            <td>{{ row['Shape'] }}</td>
            <td>{{ row['Location'] }}</td>
            <td>{{ row['Scale'] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>No operating scenarios data available.</p>
      {% endif %}
    </div>

    
    <!-- Population Parameters Summary - Corrected and explicitly fixed -->
    <!-- Population Parameters Summary -->
    <button class="accordion">Population Parameters <a class="edit-link" href="{{ url_for('population') }}">Edit</a></button>
    <div class="panel">
      {% if population_parameters %}
      <div class="summary-table-container">
        <table class="summary-table">
          <thead>
            <tr>
              {% for col in population_parameters[0].keys() %}
                <th>{{ col }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in population_parameters %}
              <tr>
                {% for value in row.values() %}
                  <td>{{ value }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>No population parameters available.</p>
      {% endif %}
    </div>

        
    <!-- Flow Scenarios Summary -->
    <button class="accordion">Flow Scenarios <a class="edit-link" href="{{ url_for('flow_scenarios') }}">Edit</a></button>
    <div class="panel">
      {% if flow_scenarios %}
      <table class="summary-table">
        <thead>
          <tr>
            {% for col in flow_scenarios[0].keys() %}
              <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for scenario in flow_scenarios %}
            <tr>
              {% for value in scenario.values() %}
                <td>{{ value }}</td>
              {% endfor %}
          </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>No Flow Scenarios provided.</p>
    {% endif %}

    </div>
    
    <!-- Graph Data Summary -->
    <button class="accordion">Graph Data <a class="edit-link" href="{{ url_for('graph_editor') }}">Edit</a></button>
    <div class="panel">
      {% if passage_routes %}
      <h4>Passage Routes</h4>
      <ul>
        {% for route in passage_routes %}
          <li>{{ route }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% if graph_summary and graph_summary.Nodes %}
      <h4>Nodes</h4>
      <table class="summary-table">
        <thead>
          <tr>
            {% for col in graph_summary.Nodes[0].keys() %}
              <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in graph_summary.Nodes %}
            <tr>
              {% for value in row.values() %}
                <td>{{ value }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endif %}
      {% if graph_summary and graph_summary.Edges %}
      <h4>Edges</h4>
      <table class="summary-table">
        <thead>
          <tr>
            {% for col in graph_summary.Edges[0].keys() %}
              <th>{{ col }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in graph_summary.Edges %}
            <tr>
              {% for value in row.values() %}
                <td>{{ value }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endif %}
      {% if not graph_summary and graph_nodes %}
      <table class="summary-table">
        <thead>
          <tr>
            <th>Nodes</th>
            <th>Edges</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><pre>{{ graph_nodes | tojson(indent=2) }}</pre></td>
            <td><pre>{{ graph_edges | tojson(indent=2) }}</pre></td>
          </tr>
        </tbody>
      </table>
      {% endif %}
      {% if not graph_summary and not graph_nodes %}
      <p>No graph data available.</p>
      {% endif %}
    </div>

    
    <!-- Save Project Before Running -->
    <div class="save-project-box">
      <h3 style="margin-top: 0; color: #0056b3;">üíæ Save Your Project</h3>
      <p style="margin: 10px 0;">Before running the simulation, save your project to preserve your work:</p>
      <form method="post" action="{{ url_for('save_project') }}" style="display: inline-block;" class="no-validate">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button type="submit" class="btn-save-project">üíæ Save Project Now</button>
      </form>
      <p style="font-size: 13px; color: #666; margin-top: 8px;">
        <em>Saves all settings, flows, facilities, parameters, and population data as a .stryke file</em>
      </p>
    </div>
    
    <!-- Big Red Run Simulation Button -->
    <form method="post" action="{{ url_for('run_simulation') }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <button type="submit" class="big-red-button">Run Simulation</button>
    </form>
    
    <p style="text-align: center; margin-top: 20px;"><a href="{{ url_for('population') }}">Back to Population Setup</a></p>
  </div>
</body>
</html>
